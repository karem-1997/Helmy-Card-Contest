<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Helmy Card V2 - Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„ÙƒØ§Ù…Ù„Ø©</title>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-auth-compat.js"></script>
    <style>
        :root { --red: #ff0000; --dark-red: #8b0000; --bg: #000000; --card: #0a0a0a; --gold: #ff9800; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: var(--bg); color: white; margin: 0; padding: 15px; }
        .container { max-width: 600px; margin: auto; }
        .card { background: var(--card); border-radius: 15px; padding: 20px; margin-bottom: 20px; border: 1px solid var(--dark-red); box-shadow: 0 0 15px rgba(255, 0, 0, 0.2); }
        input { width: 100%; padding: 12px; margin: 8px 0; border-radius: 8px; border: 1px solid #333; background: #111; color: white; }
        .btn-main { background: linear-gradient(45deg, var(--dark-red), var(--red)); color: white; font-weight: bold; cursor: pointer; border: none; padding: 12px; border-radius: 8px; width: 100%; }
        .btn-sub { background: #222; color: #ccc; cursor: pointer; border: none; padding: 8px; border-radius: 5px; font-size: 12px; width: 100%; }
        .hidden { display: none !important; }
        
        /* Ø§Ù„Ø²Ø± Ø§Ù„Ø¹Ø§Ø¦Ù… */
        .floating-btn { position: fixed; bottom: 20px; left: 20px; background: var(--red); color: white; padding: 15px 25px; border-radius: 50px; font-weight: bold; cursor: pointer; border: none; z-index: 1000; box-shadow: 0 0 15px var(--red); }
        
        /* Ù…ÙˆØ¯Ø§Ù„ Ø§Ù„Ù‚ÙˆØ§Ø¹Ø¯ */
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 2000; display: flex; align-items: center; justify-content: center; }
        .modal-content { background: var(--card); border: 2px solid var(--red); width: 90%; max-width: 500px; padding: 25px; border-radius: 20px; max-height: 80vh; overflow-y: auto; }
        
        table { width: 100%; border-collapse: collapse; font-size: 11px; margin-top: 10px; }
        th, td { border: 1px solid #222; padding: 8px; text-align: center; }
        .status-badge { padding: 4px 8px; border-radius: 4px; font-size: 10px; }
    </style>
</head>
<body>

<button class="floating-btn" onclick="showTerms(true)">ğŸ“œ Ø´Ø±ÙˆØ· Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©</button>

<div id="termsModal" class="modal hidden">
    <div class="modal-content">
        <h2 style="color:var(--red); text-align:center; border-bottom: 1px solid var(--red); padding-bottom: 10px;">ğŸ† Ø´Ø±ÙˆØ· ÙˆÙ‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©</h2>
        <div style="line-height: 1.8; text-align: right; font-size: 14px;">
            <p><b>1. Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹:</b> ÙŠØ¬Ø¨ Ø´Ø­Ù† Ù…Ø¨Ù„Øº 1000 Ø¬Ù†ÙŠÙ‡ ÙƒØ­Ø¯ Ø£Ø¯Ù†Ù‰ Ù„Ù„Ø¯Ø®ÙˆÙ„ ÙÙŠ Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©.</p>
            <p><b>2. Ø¨ÙˆÙ†Øµ Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹:</b> ÙŠØ­ØµÙ„ Ø§Ù„ÙˆÙƒÙŠÙ„ Ø§Ù„Ù…Ø´Ø­Ù† Ø¹Ù„Ù‰ 5% Ø¨ÙˆÙ†Øµ ÙÙˆØ±ÙŠ ÙŠØ¶Ø§Ù Ù„Ø±ØµÙŠØ¯Ù‡ Ø¨Ø¹Ø¯ ØªØ£ÙƒÙŠØ¯ Ø­Ù„Ù…ÙŠ.</p>
            <p><b>3. Ø¨ÙˆÙ†Øµ Ø§Ù„Ø¯Ø¹ÙˆØ©:</b> ÙŠØ­ØµÙ„ Ø§Ù„Ø´Ø®Øµ "Ø§Ù„Ø¯Ø§Ø¹ÙŠ" Ø¹Ù„Ù‰ 10% Ø¨ÙˆÙ†Øµ Ù…Ù† Ù‚ÙŠÙ…Ø© Ø´Ø­Ù† Ø£ÙŠ Ø´Ø®Øµ ÙŠØ³Ø¬Ù„ Ù…Ù† Ø®Ù„Ø§Ù„Ù‡ Ø®Ù„Ø§Ù„ ÙØªØ±Ø© Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©.</p>
            <p><b>4. Ø§Ù„ØªÙØ¹ÙŠÙ„ Ø§Ù„ÙŠØ¯ÙˆÙŠ:</b> Ù„Ø§ ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ø£ÙŠ Ø±ØµÙŠØ¯ Ø¥Ù„Ø§ Ø¨Ø¹Ø¯ Ù…Ø±Ø§Ø¬Ø¹Ø© Ø­Ù„Ù…ÙŠ Ù„Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„ÙØ¹Ù„ÙŠ Ù„Ø¶Ù…Ø§Ù† Ø­Ù‚ÙˆÙ‚ Ø§Ù„Ø¬Ù…ÙŠØ¹.</p>
            <p><b>5. Ø§Ù„ØªØ±Ù‚ÙŠØ§Øª:</b> Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù€ 10 Ø¯Ø¹ÙˆØ§Øª ÙØ¹Ø§Ù„Ø© ÙŠØ¤Ù‡Ù„Ùƒ Ù„Ù…Ø³ØªÙˆÙ‰ VIP 7 ÙˆÙ…Ù…ÙŠØ²Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©.</p>
            <p><b>6. Ø§Ù„Ø£Ù…Ø§Ù†:</b> Ø£ÙŠ Ù…Ø­Ø§ÙˆÙ„Ø© ØªÙ„Ø§Ø¹Ø¨ Ø¨Ø§Ù„Ø·Ù„Ø¨Ø§Øª ØªØ¹Ø±Ø¶ Ø§Ù„Ø­Ø³Ø§Ø¨ Ù„Ù„Ø­Ø¸Ø± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ.</p>
            <p style="color:var(--gold); font-weight:bold; border-top:1px solid #333; padding-top:10px;">Ù…Ù„Ø§Ø­Ø¸Ø©: Ù‡Ø°Ù‡ Ø§Ù„Ø´Ø±ÙˆØ· Ù…Ù„Ø²Ù…Ø© Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø´ØªØ±ÙƒÙŠÙ† Ù„Ø¶Ù…Ø§Ù† Ù†Ø²Ø§Ù‡Ø© Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©.</p>
        </div>
        <button class="btn-main" onclick="showTerms(false)">Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù‚ÙˆØ§Ø¹Ø¯</button>
    </div>
</div>

<div class="container">
    <h1 style="text-align: center; color: var(--red); text-shadow: 0 0 15px var(--red); margin-top: 40px;">ğŸ¦… HELMY CARD V2</h1>

    <div id="auth-section" class="card">
        <div style="display:flex; gap:10px; margin-bottom:20px">
            <button id="btnL" class="btn-main" onclick="toggleAuth('login')">Ø¯Ø®ÙˆÙ„</button>
            <button id="btnR" class="btn-sub" onclick="toggleAuth('register')">ØªØ³Ø¬ÙŠÙ„ Ø¬Ø¯ÙŠØ¯</button>
        </div>
        <input type="email" id="email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">
        <input type="password" id="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
        <div id="reg-fields" class="hidden">
            <input type="text" id="fullName" placeholder="Ø§Ù„Ø§Ø³Ù… Ø¨Ø§Ù„ÙƒØ§Ù…Ù„">
            <input type="text" id="customCode" placeholder="ÙƒÙˆØ¯ Ø§Ù„Ø¯Ø¹ÙˆØ© Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ (Ù…Ø«Ù„Ø§Ù‹: kimo1)">
            <input type="text" id="wallet" placeholder="Ø±Ù‚Ù… Ù…Ø­ÙØ¸Ø© Ø§Ù„ÙƒØ§Ø´">
            <input type="text" id="invBy" placeholder="ÙƒÙˆØ¯ Ø§Ù„Ø¯Ø§Ø¹ÙŠ (Ø¥Ù† ÙˆØ¬Ø¯)">
        </div>
        <button class="btn-main" id="authBtn" onclick="processAuth()" style="margin-top:15px">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø£Ù†</button>
    </div>

    <div id="user-section" class="hidden">
        <div class="card" style="border-color: var(--gold);">
            <h3>Ø£Ù‡Ù„Ø§Ù‹: <span id="uName" style="color:var(--red)">...</span></h3>
            <div style="display:flex; justify-content:space-around; text-align:center;">
                <div><h2 id="uBalance" style="color:var(--gold)">0</h2><p>Ø±ØµÙŠØ¯Ùƒ</p></div>
                <div><h2 id="uTeam" style="color:var(--gold)">0</h2><p>ÙØ±ÙŠÙ‚Ùƒ</p></div>
            </div>
            <div style="text-align:center; background:#111; padding:10px; border:1px dashed var(--gold); border-radius:8px;">
                <small>ÙƒÙˆØ¯ Ø¯Ø¹ÙˆØªÙƒ:</small><br><b id="uCode" style="font-size:20px; color:var(--gold)"></b>
            </div>
        </div>
        <div class="card">
            <h3>ğŸ’° Ø¥Ø¨Ù„Ø§Øº Ø­Ù„Ù…ÙŠ Ø¨Ø´Ø­Ù† Ø¬Ø¯ÙŠØ¯</h3>
            <input type="number" id="depAmt" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø°ÙŠ Ø­ÙˆÙ„ØªÙ‡">
            <button class="btn-main" onclick="sendReq()">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨</button>
            <div id="reqMsg" style="text-align:center; margin-top:10px"></div>
        </div>
        <div class="card">
            <h3>ğŸŒ³ Ø´Ø¬Ø±Ø© ÙˆÙƒÙ„Ø§Ø¦Ùƒ</h3>
            <div id="tree"></div>
        </div>
        <button class="btn-sub" onclick="logout()">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
    </div>

    <div id="admin-section" class="hidden">
        <div class="card" style="border-color: #00ff00;">
            <h2 style="color:#00ff00; text-align:center">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø¹Ù„ÙŠØ§ ğŸ‘‘</h2>
            <table>
                <thead><tr><th>Ø§Ù„ÙˆÙƒÙŠÙ„</th><th>Ø§Ù„Ù…Ø¨Ù„Øº+5%</th><th>ØªØ£ÙƒÙŠØ¯</th></tr></thead>
                <tbody id="admRequests"></tbody>
            </table>
        </div>
        <div class="card">
            <h3>Ø¥Ø¯Ø§Ø±Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙˆÙƒÙ„Ø§Ø¡</h3>
            <table>
                <thead><tr><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„Ø±ØµÙŠØ¯</th><th>Ø¥Ø¬Ø±Ø§Ø¡</th></tr></thead>
                <tbody id="admUsers"></tbody>
            </table>
        </div>
        <button class="btn-sub" onclick="logout()">Ø®Ø±ÙˆØ¬ Ù†Ù‡Ø§Ø¦ÙŠ</button>
    </div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyBAIB47-TaUEZDZHlXgAsI4RUckzn8C3Io",
        authDomain: "helmy-card-contest.firebaseapp.com",
        projectId: "helmy-card-contest",
        storageBucket: "helmy-card-contest.firebasestorage.app",
        messagingSenderId: "765996977390",
        appId: "1:765996977390:web:b5ce6c4980e6bbfa40b7ff"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();
    const ADMIN = "admin@helmy.com";

    function showTerms(s) { document.getElementById('termsModal').classList.toggle('hidden', !s); }
    function toggleAuth(m) {
        window.mode = m;
        const isR = m === 'register';
        document.getElementById('reg-fields').classList.toggle('hidden', !isR);
        document.getElementById('authBtn').innerText = isR ? 'Ø¥ØªÙ…Ø§Ù… Ø§Ù„ØªØ³Ø¬ÙŠÙ„' : 'Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø£Ù†';
        document.getElementById('btnL').className = isR ? 'btn-sub' : 'btn-main';
        document.getElementById('btnR').className = isR ? 'btn-main' : 'btn-sub';
    }

    async function processAuth() {
        const email = document.getElementById('email').value;
        const pass = document.getElementById('password').value;
        if(window.mode !== 'register') {
            auth.signInWithEmailAndPassword(email, pass).catch(e => alert("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª"));
        } else {
            const name = document.getElementById('fullName').value;
            const myCode = document.getElementById('customCode').value;
            const wall = document.getElementById('wallet').value;
            const inv = document.getElementById('invBy').value;
            try {
                const res = await auth.createUserWithEmailAndPassword(email, pass);
                await db.collection("users").doc(res.user.uid).set({
                    name, myCode, wallet: wall, email, balance: 0, invitedBy: inv || "direct", uid: res.user.uid
                });
            } catch(e) { alert(e.message); }
        }
    }

    auth.onAuthStateChanged(user => {
        if(user) {
            document.getElementById('auth-section').classList.add('hidden');
            if(user.email === ADMIN) {
                document.getElementById('admin-section').classList.remove('hidden');
                loadAdmin();
            } else {
                document.getElementById('user-section').classList.remove('hidden');
                loadUser(user);
            }
        }
    });

    function loadUser(user) {
        db.collection("users").doc(user.uid).onSnapshot(d => {
            const u = d.data();
            if(u) {
                document.getElementById('uName').innerText = u.name;
                document.getElementById('uBalance').innerText = u.balance + " Ø¬";
                document.getElementById('uCode').innerText = u.myCode;
                db.collection("users").where("invitedBy", "==", u.myCode).onSnapshot(s => {
                    document.getElementById('uTeam').innerText = s.size;
                    const tree = document.getElementById('tree');
                    tree.innerHTML = s.empty ? "Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆÙƒÙ„Ø§Ø¡ ÙÙŠ Ø´Ø¬Ø±ØªÙƒ" : "";
                    s.forEach(m => tree.innerHTML += `<div class="tree-item">ğŸ‘¤ ${m.data().name} (${m.data().email})</div>`);
                });
            }
        });
        db.collection("requests").where("uid", "==", user.uid).orderBy("createdAt", "desc").limit(1).onSnapshot(s => {
            const msg = document.getElementById('reqMsg');
            if(!s.empty) {
                const r = s.docs[0].data();
                msg.innerHTML = r.status === "ØªÙ…" ? `<span style="color:green">ØªÙ… ØªØ£ÙƒÙŠØ¯ Ø´Ø­Ù†ØªÙƒ âœ…</span>` : `<span style="color:gray">Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ù…Ø±Ø§Ø¬Ø¹Ø© Ø­Ù„Ù…ÙŠ.. â³</span>`;
            }
        });
    }

    async function sendReq() {
        const amt = Number(document.getElementById('depAmt').value);
        if(amt < 1000) return alert("Ø£Ù‚Ù„ Ø´Ø­Ù† 1000Ø¬");
        const u = (await db.collection("users").doc(auth.currentUser.uid).get()).data();
        await db.collection("requests").add({ uid: auth.currentUser.uid, name: u.name, amount: amt, status: "Ù…Ø¹Ù„Ù‚", createdAt: new Date() });
        alert("ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨!");
    }

    function loadAdmin() {
        db.collection("requests").where("status", "==", "Ù…Ø¹Ù„Ù‚").onSnapshot(s => {
            const list = document.getElementById('admRequests');
            list.innerHTML = "";
            s.forEach(doc => {
                const d = doc.data();
                const total = d.amount + (d.amount * 0.05);
                list.innerHTML += `<tr><td>${d.name}</td><td>${total}Ø¬</td><td><button class="btn-main" onclick="approve('${doc.id}', '${d.uid}', ${total})">ØªØ£ÙƒÙŠØ¯</button></td></tr>`;
            });
        });
        db.collection("users").onSnapshot(s => {
            const list = document.getElementById('admUsers');
            list.innerHTML = "";
            s.forEach(doc => {
                const u = doc.data();
                if(u.email !== ADMIN) {
                    list.innerHTML += `<tr><td>${u.name}</td><td>${u.balance}Ø¬</td><td><button onclick="delU('${doc.id}')" style="background:red; color:white; border:none; padding:5px; border-radius:3px">Ø­Ø°Ù</button></td></tr>`;
                }
            });
        });
    }

    async function approve(id, uid, total) {
        await db.collection("users").doc(uid).update({ balance: firebase.firestore.FieldValue.increment(total) });
        await db.collection("requests").doc(id).update({ status: "ØªÙ…" });
    }

    async function delU(id) { if(confirm("Ø­Ø°Ù Ø§Ù„ÙˆÙƒÙŠÙ„ØŸ")) await db.collection("users").doc(id).delete(); }
    function logout() { auth.signOut(); location.reload(); }
</script>
</body>
</html>
