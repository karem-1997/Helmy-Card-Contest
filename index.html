<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Helmy Card - Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø·ÙˆØ±</title>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-auth-compat.js"></script>
    <style>
        :root { --red: #ff0000; --dark-red: #8b0000; --bg: #000000; --card: #0a0a0a; --gold: #ff9800; --green: #00ff00; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: var(--bg); color: white; margin: 0; padding: 15px; }
        .container { max-width: 650px; margin: auto; }
        .card { background: var(--card); border-radius: 15px; padding: 20px; margin-bottom: 20px; border: 1px solid var(--dark-red); box-shadow: 0 0 15px rgba(255, 0, 0, 0.2); position: relative; }
        .vip-tag { position: absolute; top: 10px; left: 10px; background: var(--gold); color: black; font-size: 10px; padding: 3px 8px; border-radius: 5px; font-weight: bold; }
        input, select { width: 100%; padding: 12px; margin: 8px 0; border-radius: 8px; border: 1px solid #333; background: #111; color: white; box-sizing: border-box; }
        .btn-main { background: linear-gradient(45deg, var(--dark-red), var(--red)); color: white; font-weight: bold; cursor: pointer; border: none; padding: 12px; border-radius: 8px; width: 100%; margin-top: 10px; }
        .btn-sub { background: #222; color: #ccc; cursor: pointer; border: none; padding: 10px; border-radius: 5px; width: 100%; }
        .hidden { display: none !important; }
        .floating-btn { position: fixed; bottom: 20px; left: 20px; background: var(--red); color: white; padding: 15px 25px; border-radius: 50px; font-weight: bold; cursor: pointer; border: none; z-index: 1000; box-shadow: 0 0 20px var(--red); }
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 2000; display: flex; align-items: center; justify-content: center; }
        .modal-content { background: var(--card); border: 2px solid var(--red); width: 90%; max-width: 500px; padding: 25px; border-radius: 20px; max-height: 85vh; overflow-y: auto; }
        table { width: 100%; border-collapse: collapse; font-size: 10px; margin-top: 10px; }
        th, td { border: 1px solid #222; padding: 8px; text-align: center; }
        .badge-old { color: #aaa; border: 1px solid #333; padding: 2px 4px; border-radius: 4px; }
        .badge-new { color: var(--green); border: 1px solid var(--green); padding: 2px 4px; border-radius: 4px; }
    </style>
</head>
<body>

<button class="floating-btn" onclick="showTerms(true)">ğŸ“œ Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©</button>

<div id="termsModal" class="modal hidden">
    <div class="modal-content">
        <h2 style="color:var(--red); text-align:center;">ğŸ¦… Ù…Ø³Ø§Ø¨Ù‚Ø© Helmy Card</h2>
        <div style="line-height: 1.6; text-align: right; font-size: 14px;">
            <p><b>ğŸ Ù…ÙƒØ§ÙØ£Ø© Ø§Ù„Ù…Ø¯Ø¹Ùˆ:</b> 5% Ø¨ÙˆÙ†Øµ ÙÙˆØ±ÙŠ Ø¹Ù„Ù‰ Ø£ÙˆÙ„ Ø¥ÙŠØ¯Ø§Ø¹.</p>
            <p><b>ğŸ Ù…ÙƒØ§ÙØ£Ø© Ø§Ù„Ø¯Ø§Ø¹ÙŠ:</b> 10% Ø¨ÙˆÙ†Øµ Ø£Ø³Ø¨ÙˆØ¹ÙŠ (Ù„ÙØ±ÙŠÙ‚ > 10) Ø£Ùˆ 5% Ø¨ÙˆÙ†Øµ.</p>
            <p><b>ğŸ’° Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰:</b> 1000 Ø¬Ù†ÙŠÙ‡ Ù…ØµØ±ÙŠ.</p>
            <p style="color:red; text-align:center;">ğŸš« ØªØ¹Ø¯Ø¯ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª = Ø­Ø¸Ø± Ø´Ø§Ù…Ù„.</p>
        </div>
        <button class="btn-main" onclick="showTerms(false)">Ù…ÙˆØ§ÙÙ‚</button>
    </div>
</div>

<div class="container">
    <h1 style="text-align: center; color: var(--red); text-shadow: 0 0 15px var(--red); margin: 20px 0;">ğŸ¦… HELMY CARD</h1>

    <div id="auth-section" class="card">
        <div style="display:flex; gap:10px; margin-bottom:20px">
            <button id="btnL" class="btn-main" onclick="toggleAuth('login')">Ø¯Ø®ÙˆÙ„</button>
            <button id="btnR" class="btn-sub" onclick="toggleAuth('register')">ØªØ³Ø¬ÙŠÙ„</button>
        </div>
        <input type="email" id="email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">
        <input type="password" id="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
        
        <div id="reg-fields" class="hidden">
            <input type="text" id="fullName" placeholder="Ø§Ù„Ø§Ø³Ù… Ø¨Ø§Ù„ÙƒØ§Ù…Ù„">
            <input type="text" id="customCode" placeholder="ÙƒÙˆØ¯ Ø§Ù„Ø¯Ø¹ÙˆØ© Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ">
            <input type="text" id="invBy" placeholder="ÙƒÙˆØ¯ Ø§Ù„Ø¯Ø§Ø¹ÙŠ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)">
            <label style="font-size: 12px; margin-right: 5px;">Ø­Ø§Ù„Ø© Ø§Ù„ÙˆÙƒÙŠÙ„:</label>
            <select id="userStatus">
                <option value="Ø¬Ø¯ÙŠØ¯">ÙˆÙƒÙŠÙ„ Ø¬Ø¯ÙŠØ¯ ğŸ†•</option>
                <option value="Ù‚Ø¯ÙŠÙ…">ÙˆÙƒÙŠÙ„ Ù‚Ø¯ÙŠÙ… ğŸ”™</option>
            </select>
        </div>
        
        <button class="btn-main" id="authBtn" onclick="processAuth()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
    </div>

    <div id="user-section" class="hidden">
        <div class="card" style="border-color: var(--gold);">
            <div class="vip-tag" id="vipLevel">VIP</div>
            <h3>Ø§Ù„ÙˆÙƒÙŠÙ„: <span id="uName" style="color:var(--red)">...</span> (<span id="uStatusDisplay" style="font-size: 12px;"></span>)</h3>
            <div style="display:flex; justify-content:space-around; text-align:center;">
                <div><h2 id="uBalance" style="color:var(--gold); margin:0;">0</h2><p>Ø±ØµÙŠØ¯Ùƒ</p></div>
                <div><h2 id="uTeam" style="color:var(--gold); margin:0;">0</h2><p>ÙØ±ÙŠÙ‚Ùƒ</p></div>
            </div>
            <div style="text-align:center; background:#111; padding:10px; border:1px dashed var(--gold); border-radius:8px; margin-top:10px;">
                <small>ÙƒÙˆØ¯ Ø¯Ø¹ÙˆØªÙƒ:</small><br><b id="uCode" style="font-size:20px; color:var(--gold)"></b>
            </div>
        </div>

        <div class="card">
            <h3 style="color:var(--green)">ğŸ’° Ø¥Ø¨Ù„Ø§Øº Ø­Ù„Ù…ÙŠ Ø¨Ø´Ø­Ù† Ø±ØµÙŠØ¯</h3>
            <input type="number" id="depAmt" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø´Ø­ÙˆÙ†">
            <button class="btn-main" onclick="sendReq()">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨</button>
            <div id="reqMsg" style="text-align:center; margin-top:10px"></div>
        </div>

        <div class="card">
            <h3>ğŸŒ³ Ø£Ø¹Ø¶Ø§Ø¡ ÙØ±ÙŠÙ‚Ùƒ</h3>
            <div id="tree"></div>
        </div>
        <button class="btn-sub" onclick="logout()">Ø®Ø±ÙˆØ¬</button>
    </div>

    <div id="admin-section" class="hidden">
        <div class="card" style="border-color: var(--green);">
            <h2 style="color:var(--green); text-align:center">Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø­Ù„Ù…ÙŠ ğŸ‘‘</h2>
            <table>
                <thead><tr><th>Ø§Ù„ÙˆÙƒÙŠÙ„</th><th>Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹</th><th>Ø§Ù„Ø¨ÙˆÙ†Øµ</th><th>ØªØ£ÙƒÙŠØ¯</th></tr></thead>
                <tbody id="admRequests"></tbody>
            </table>
        </div>
        <div class="card">
            <h3>ÙƒÙ„ Ø§Ù„ÙˆÙƒÙ„Ø§Ø¡ Ø§Ù„Ù…Ø³Ø¬Ù„ÙŠÙ†</h3>
            <table>
                <thead><tr><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„Ø±ØµÙŠØ¯</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th><th>ID Ø§Ù„ÙˆÙƒÙŠÙ„</th><th>Ø¥Ø¬Ø±Ø§Ø¡</th></tr></thead>
                <tbody id="admUsers"></tbody>
            </table>
        </div>
        <button class="btn-sub" onclick="logout()">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</button>
    </div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyBAIB47-TaUEZDZHlXgAsI4RUckzn8C3Io",
        authDomain: "helmy-card-contest.firebaseapp.com",
        projectId: "helmy-card-contest",
        storageBucket: "helmy-card-contest.firebasestorage.app",
        messagingSenderId: "765996977390",
        appId: "1:765996977390:web:b5ce6c4980e6bbfa40b7ff"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();
    const ADMIN = "admin@helmy.com";

    function showTerms(s) { document.getElementById('termsModal').classList.toggle('hidden', !s); }
    function toggleAuth(m) {
        window.mode = m;
        const isR = m === 'register';
        document.getElementById('reg-fields').classList.toggle('hidden', !isR);
        document.getElementById('authBtn').innerText = isR ? 'ØªØ£ÙƒÙŠØ¯ Ø§Ù„ØªØ³Ø¬ÙŠÙ„' : 'ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„';
        document.getElementById('btnL').className = isR ? 'btn-sub' : 'btn-main';
        document.getElementById('btnR').className = isR ? 'btn-main' : 'btn-sub';
    }

    async function processAuth() {
        const email = document.getElementById('email').value;
        const pass = document.getElementById('password').value;
        if(window.mode !== 'register') {
            auth.signInWithEmailAndPassword(email, pass).catch(e => alert("Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø®Ø§Ø·Ø¦Ø©"));
        } else {
            const name = document.getElementById('fullName').value;
            const myCode = document.getElementById('customCode').value;
            const inv = document.getElementById('invBy').value;
            const status = document.getElementById('userStatus').value;
            try {
                const res = await auth.createUserWithEmailAndPassword(email, pass);
                await db.collection("users").doc(res.user.uid).set({
                    name, myCode, email, balance: 0, invitedBy: inv || "direct", uid: res.user.uid, 
                    isFirstDep: true, userType: status 
                });
            } catch(e) { alert(e.message); }
        }
    }

    auth.onAuthStateChanged(user => {
        if(user) {
            document.getElementById('auth-section').classList.add('hidden');
            if(user.email === ADMIN) {
                document.getElementById('admin-section').classList.remove('hidden');
                loadAdmin();
            } else {
                document.getElementById('user-section').classList.remove('hidden');
                loadUser(user);
            }
        }
    });

    function loadUser(user) {
        db.collection("users").doc(user.uid).onSnapshot(d => {
            const u = d.data();
            if(u) {
                document.getElementById('uName').innerText = u.name;
                document.getElementById('uBalance').innerText = u.balance + " Ø¬";
                document.getElementById('uCode').innerText = u.myCode;
                document.getElementById('uStatusDisplay').innerText = u.userType || "Ø¬Ø¯ÙŠØ¯";
                document.getElementById('vipLevel').innerText = u.invitedBy === "direct" ? "VIP 7" : "VIP 5";
                db.collection("users").where("invitedBy", "==", u.myCode).onSnapshot(s => {
                    document.getElementById('uTeam').innerText = s.size;
                    const tree = document.getElementById('tree');
                    tree.innerHTML = s.empty ? "Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆÙƒÙ„Ø§Ø¡ ÙÙŠ ÙØ±ÙŠÙ‚Ùƒ" : "";
                    s.forEach(m => tree.innerHTML += `<div style="background:#111; padding:8px; margin-top:5px; border-radius:5px; border-right:3px solid var(--red);">ğŸ‘¤ ${m.data().name}</div>`);
                });
            }
        });
        db.collection("requests").where("uid", "==", user.uid).orderBy("createdAt", "desc").limit(1).onSnapshot(s => {
            const msg = document.getElementById('reqMsg');
            if(!s.empty) {
                const r = s.docs[0].data();
                msg.innerHTML = r.status === "ØªÙ…" ? `<span style="color:var(--green)">âœ… ØªÙ…Øª Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©</span>` : `<span style="color:#888">â³ Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</span>`;
            }
        });
    }

    async function sendReq() {
        const amt = Number(document.getElementById('depAmt').value);
        if(amt < 1000) return alert("Ø£Ù‚Ù„ Ø¥ÙŠØ¯Ø§Ø¹ 1000 Ø¬Ù†ÙŠÙ‡");
        const uDoc = await db.collection("users").doc(auth.currentUser.uid).get();
        const u = uDoc.data();
        const bonus = (u.invitedBy !== "direct" && u.isFirstDep) ? (amt * 0.05) : 0;
        await db.collection("requests").add({ uid: auth.currentUser.uid, name: u.name, amount: amt, bonus: bonus, status: "Ù…Ø¹Ù„Ù‚", createdAt: new Date() });
        alert("ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨!");
    }

    function loadAdmin() {
        db.collection("requests").where("status", "==", "Ù…Ø¹Ù„Ù‚").onSnapshot(s => {
            const list = document.getElementById('admRequests');
            list.innerHTML = "";
            s.forEach(doc => {
                const d = doc.data();
                list.innerHTML += `<tr><td>${d.name}</td><td>${d.amount}Ø¬</td><td style="color:var(--gold)">+${d.bonus}Ø¬</td><td><button onclick="approve('${doc.id}', '${d.uid}', ${d.amount}, ${d.bonus})" style="background:var(--green); border:none; padding:4px; border-radius:4px; font-size:10px;">ØªØ£ÙƒÙŠØ¯</button></td></tr>`;
            });
        });
        db.collection("users").onSnapshot(s => {
            const list = document.getElementById('admUsers');
            list.innerHTML = "";
            s.forEach(doc => {
                const u = doc.data();
                if(u.email !== ADMIN) {
                    const statusClass = u.userType === 'Ø¬Ø¯ÙŠØ¯' ? 'badge-new' : 'badge-old';
                    list.innerHTML += `<tr><td>${u.name}</td><td>${u.balance}Ø¬</td><td><span class="${statusClass}">${u.userType || 'Ø¬Ø¯ÙŠØ¯'}</span></td><td style="font-size:8px; color:#555;">${u.uid}</td><td><button onclick="delU('${doc.id}')" style="background:red; color:white; border:none; padding:2px 5px; border-radius:3px;">X</button></td></tr>`;
                }
            });
        });
    }

    async function approve(id, uid, amt, bonus) {
        await db.collection("users").doc(uid).update({ balance: firebase.firestore.FieldValue.increment(amt + bonus), isFirstDep: false });
        await db.collection("requests").doc(id).update({ status: "ØªÙ…" });
    }

    async function delU(id) { if(confirm("Ø­Ø°Ù Ø§Ù„Ø­Ø³Ø§Ø¨ Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ")) await db.collection("users").doc(id).delete(); }
    function logout() { auth.signOut(); location.reload(); }
</script>
</body>
</html>
